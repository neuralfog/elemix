"use strict";var J=Object.defineProperty;var X=(l,o,m)=>o in l?J(l,o,{enumerable:!0,configurable:!0,writable:!0,value:m}):l[o]=m;var O=(l,o,m)=>X(l,typeof o!="symbol"?o+"":o,m);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var L={},f={},V;function tt(){if(V)return f;V=1;const l="â‚¥";var o=(c=>(c[c.EVENT=0]="EVENT",c[c.PROP=1]="PROP",c[c.DIRECT=2]="DIRECT",c[c.MODEL=3]="MODEL",c[c.STD=4]="STD",c))(o||{});const m=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,d=c=>{const v=new RegExp(`${l}(\\d+)`),g=c.match(v);if(!g)throw new Error("Unable to extract index from hole comment");return Number(g[1])},a=c=>`<!--${l}${c}-->`,y=()=>Math.floor(performance.now()*1e3).toString(36)+Math.random().toString(36).slice(2,6),E=c=>c.replace(/<([a-zA-Z][^\s/>]*)([^>]*)\/>/g,(v,g,N)=>m.test(g)?v:`<${g}${N}></${g}>`),A=c=>c.replace(/(\S+)=((<!--[\s\S]*?-->)|([^\s">]+))/g,'$1="$2"');return f.Attributes=o,f.TEMPLATE_MARKER_GLYPH=l,f.fastUID=y,f.fixAttributeQuotes=A,f.fixSelfClosingTags=E,f.getIndexFromComment=d,f.makeMarkerComment=a,f}var x;function et(){return x||(x=1,function(l){var o=Object.defineProperty,m=(i,t,s)=>t in i?o(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s,d=(i,t,s)=>m(i,typeof t!="symbol"?t+"":t,s);Object.defineProperty(l,Symbol.toStringTag,{value:"Module"});const a=tt(),y=i=>{const t=i;return t.$cache||(t.$cache={template:new Map}),t.$cache};class E{constructor(t,s){d(this,"key",""),this.strings=t,this.values=s}}class A{constructor(t,s){this.node=t,this.definition=s}setValue(t){const s=this.definition.name.slice(1);this.node[s]=t}}class c{constructor(t,s){this.node=t,this.definition=s}setValue(t){const s=this.definition.name.slice(1);this.node[`on${s}`]=t}}class v{constructor(t,s){this.node=t,this.definition=s}setValue(t){const s=e=>{t.value=e.target.value};this.node.oninput||(this.node.value=t.value,this.node.oninput=s)}}class g{constructor(t,s){this.node=t,this.definition=s}setValue(t){const s=this.definition.name.slice(1),e=this.node;e.$props&&e.$props.set(s,t)}}let N=class{constructor(i,t){this.node=i,this.definition=t}setValue(i){this.node.setAttribute(this.definition.name,String(i))}};const I=(i,t)=>{const s=/(\S+)(?==(?:["']?)$)/,e=i.match(s);if(e){const n={index:t,name:e[1],value:a.makeMarkerComment(t),virtual:!1,type:a.Attributes.STD};switch(e[1][0]){case"@":return n.type=a.Attributes.EVENT,n.virtual=!0,n;case":":return n.type=a.Attributes.PROP,n.virtual=!0,n;case".":return n.type=a.Attributes.DIRECT,n.virtual=!0,n;case"~":return e[1].startsWith("~model")&&(n.type=a.Attributes.MODEL,n.virtual=!0),n;default:return n}}},q=(i,t)=>{const s=i.querySelector(F(t.name,t.value,t.virtual));if(s)switch(t.virtual&&s.removeAttribute(t.name),t.type){case a.Attributes.EVENT:return new c(s,t);case a.Attributes.PROP:return new g(s,t);case a.Attributes.DIRECT:return new A(s,t);case a.Attributes.MODEL:return new v(s,t);default:return new N(s,t)}},F=(i,t,s)=>s?`[\\${i}='${t}']`:`[${i}='${t}']`,K=(i,t)=>{const s=i.length,e=t.length,n=Object.create(null);let r,u,h;for(r=0;r<s;r++)u=i[r].key,n[u]=r;const p=new Array(e),T=[],b=[],C=Object.create(null);for(r=0;r<e;r++){const w=t[r].key;C[w]=!0;const k=n[w];k===void 0?p[r]=-1:(p[r]=k,T.push(k),b.push(r))}const R=j(T),M=new Array(e);for(r=0;r<e;r++)M[r]=!1;const Z=R.length;for(r=0;r<Z;r++)M[b[R[r]]]=!0;const $=[],P=[],H=[];for(r=0;r<s;r++)h=i[r].key,C[h]!==!0&&$.push({key:h});for(r=0;r<e;r++){h=t[r].key;const w=r+1<e?t[r+1].key:void 0;p[r]===-1?P.push({key:h,value:t[r],beforeKey:w}):M[r]||H.push({key:h,beforeKey:w})}return{deletes:$,inserts:P,moves:H}},j=i=>{const t=i.length,s=new Array(t),e=[];let n,r,u,h;for(n=0;n<t;n++){for(r=0,u=e.length;r<u;)h=r+u>>>1,i[e[h]]<i[n]?r=h+1:u=h;r===e.length?e.push(n):e[r]=n,s[n]=r>0?e[r-1]:-1}const p=e.length,T=new Array(p);let b=e[p-1];for(n=p-1;n>=0;n--)T[n]=b,b=s[b];return T};class _{constructor(t){d(this,"cache",{listTemplate:new Map,listNodes:new Map,listHtmlTemplate:[]}),this.commentNode=t}renderListElement(t,s){if(!this.commentNode)throw new Error("renderList method needs to accept instance of HTMLElement");if(!t.key)throw new Error("use repeat directive when rendering the lists");let e=this.cache.listTemplate.get(t.key);return e||(e=new S(t),this.cache.listTemplate.set(t.key,e),e.mountListElement(this.commentNode,t.key,t.values,this.cache,s)),e}renderAllItems(t){const s=t.length;for(let e=0;e<s;e++)this.renderListElement(t[e]).update(t[e].values)}emptyList(){for(const[,t]of this.cache.listNodes)t.remove();this.cache.listTemplate.clear(),this.cache.listNodes.clear()}deleteNodes(t){const s=t.length;for(let e=s-1;e>=0;e--){const n=this.cache.listNodes.get(t[e].key);n&&n.remove(),this.cache.listNodes.delete(t[e].key),this.cache.listTemplate.delete(t[e].key)}}moveNodes(t){const s=t.length;for(let e=s-1;e>=0;e--){const n=this.cache.listNodes.get(t[e].key),r=this.cache.listNodes.get(t[e].beforeKey);n&&r&&(r==null||r.before(n)),!r&&n&&this.commentNode.before(n)}}insertNodes(t){const s=t.length;for(let e=s-1;e>=0;e--){const n=this.cache.listNodes.get(t[e].beforeKey);this.renderListElement(t[e].value,n)}}updateAllItems(t){const s=t.length;for(let e=0;e<s;e++){const n=this.cache.listTemplate.get(t[e].key);n==null||n.update(t[e].values)}}render(t){if(!this.cache.listHtmlTemplate.length){this.renderAllItems(t),this.cache.listHtmlTemplate=t;return}if(!t.length){this.emptyList(),this.cache.listHtmlTemplate=t;return}const{deletes:s,inserts:e,moves:n}=K(this.cache.listHtmlTemplate,t);if(s.length===t.length||e.length===t.length){this.emptyList(),this.renderAllItems(t),this.cache.listHtmlTemplate=t;return}s.length&&this.deleteNodes(s),n.length&&this.moveNodes(n),e.length&&this.insertNodes(e),this.updateAllItems(t),this.cache.listHtmlTemplate=t}}class U{constructor(t){d(this,"renderer"),this.commentNode=t,this.renderer=new _(t)}setValue(t){this.renderer.render(t)}}class W{constructor(t){d(this,"node",document.createTextNode("")),this.commentNode=t,t.before(this.node)}setValue(t){const s=t!=null?String(t):"";this.node.textContent!==s&&(this.node.textContent=s)}}class G{constructor(t){d(this,"cache",{nodes:[]}),this.commentNode=t}removeNodes(){if(!this.cache.nodes.length)return;const t=this.cache.nodes.length;for(let s=0;s<t;s++)this.cache.nodes[s].remove();this.cache.nodes=[]}render(t){this.cache.strings!==t.strings&&(this.cache.fragment=void 0,this.removeNodes()),this.cache.fragment||(this.cache.fragment=new S(t),this.cache.strings=t.strings,this.cache.nodes=this.cache.fragment.mountTemplate(this.commentNode,t.values)),this.cache.fragment.update(t.values)}}class Q{constructor(t){d(this,"renderer"),this.commentNode=t,this.renderer=new G(t)}setValue(t){this.renderer.render(t)}}const Y=(i,t)=>Array.isArray(i)?new U(t):i instanceof E?new Q(t):new W(t);class S{constructor(t){d(this,"holes",new Map),d(this,"htmlString",""),d(this,"attributeMap",[]),this.parse(t.strings)}parse(t){const s=t.length;for(let e=0;e<s;e++)if(this.htmlString+=t[e],e<t.length-1){const n=I(this.htmlString,e);n&&this.attributeMap.push(n),this.htmlString+=a.makeMarkerComment(e)}this.htmlString=a.fixSelfClosingTags(this.htmlString),this.htmlString=a.fixAttributeQuotes(this.htmlString)}initFragment(){const t=document.createElement("template");return t.innerHTML=this.htmlString,t.content}hydrateAttributes(t){const s=this.attributeMap.length;for(let e=0;e<s;e++){const n=q(t,this.attributeMap[e]);n&&this.holes.set(this.attributeMap[e].index,n)}return t}hydrateTemplateHoles(t,s){var e;const n=document.createTreeWalker(t,NodeFilter.SHOW_COMMENT,null);for(;n.nextNode();){const r=n.currentNode;if((e=r.nodeValue)!=null&&e.includes(a.TEMPLATE_MARKER_GLYPH)){const u=a.getIndexFromComment(r.nodeValue),h=Y(s[u],r);this.holes.set(u,h)}}return t}mount(t,s){const e=this.initFragment();this.hydrateTemplateHoles(e,s),this.hydrateAttributes(e),t.appendChild(e)}mountTemplate(t,s){const e=this.initFragment();this.hydrateTemplateHoles(e,s),this.hydrateAttributes(e);const n=Array.from(e.childNodes);return t.before(e),n}mountListElement(t,s,e,n,r){const u=this.initFragment();this.hydrateTemplateHoles(u,e),this.hydrateAttributes(u),r&&r.before(u),t.before(u);const h=r?r.previousSibling:t.previousSibling;h&&n&&n.listNodes.set(s,h)}update(t){for(const[s,e]of this.holes)e.setValue(t[s])}}const z=(i,...t)=>new E(i,t),B=(i,t)=>{if(!t)throw new Error("render method needs to accept instance of HTMLElement");const s=y(t);let e=s.template.get(i.strings);e||(e=new S(i),s.template.set(i.strings,e),e.mount(t,i.values)),e.update(i.values)};l.html=z,l.render=B}(L)),L}var st=et();const D=(l,o)=>{const m=Array.from(l.querySelectorAll(o)),d=a=>{for(const y of D(a,o))m.includes(y)||m.push(y)};l instanceof HTMLElement&&l.shadowRoot&&d(l.shadowRoot);for(const a of l.querySelectorAll("*"))a.shadowRoot&&d(a.shadowRoot);return m},nt=(l,o)=>D(l,o)[0];class rt{constructor(){O(this,"rootElement")}screen(o){if(st.render(o,document.body),this.rootElement=document.body.firstElementChild,!this.rootElement)throw new Error("Can not find first element within a Presenter Screen");return this}root(){return this.rootElement}wait(o=0){return new Promise(m=>{setTimeout(()=>{m()},o)})}getByTag(o){return nt(this.get(),o)}get(){return this.rootElement}}exports.Present=rt;
